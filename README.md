# æ—…æ¸¸ç½‘ç«™ç³»ç»Ÿ

ä¸€ä¸ªç°ä»£åŒ–çš„æ—…æ¸¸ç½‘ç«™ç³»ç»Ÿï¼ŒåŒ…å«ç”¨æˆ·å‰ç«¯å’Œç®¡ç†åå°ï¼Œæ”¯æŒæ™¯ç‚¹å±•ç¤ºã€è·¯çº¿è§„åˆ’ã€ç”¨æˆ·ç®¡ç†ç­‰åŠŸèƒ½ã€‚

**ç‰ˆæœ¬**: v1.6.1  
**æœ€åæ›´æ–°**: 2025-11-01  
**éƒ¨ç½²çŠ¶æ€**: âœ… ç”Ÿäº§ç¯å¢ƒè¿è¡Œä¸­ (å®å¡”é¢æ¿)  
**æœåŠ¡å™¨**: å®å¡”é¢æ¿éƒ¨ç½²  
**æ•°æ®åº“**: MySQL 8.0 (å·²æˆåŠŸè¿ç§»åˆ°å®å¡”æ•°æ®åº“)  
**APIçŠ¶æ€**: âœ… æ‰€æœ‰æ¥å£æ­£å¸¸è¿è¡Œ  
**ç®¡ç†åå°**: âœ… æ•°æ®åº“ä¿¡æ¯èœå•å·²ä¿®å¤  
**Nginxé…ç½®**: âœ… å·²ä¼˜åŒ–SPAè·¯ç”±å¤„ç†

## ğŸš€ æŠ€æœ¯æ ˆ

- **å‰ç«¯**: React 18 + TypeScript + Vite + Tailwind CSS
- **åå°ç®¡ç†**: React + TypeScript + Vite
- **åç«¯**: Node.js + Express
- **æ•°æ®åº“**: MySQL 8.0+
- **éƒ¨ç½²**: å®å¡”é¢æ¿ (æ¨è)

## âœ¨ ä¸»è¦åŠŸèƒ½

### å‰ç«¯åŠŸèƒ½
- ğŸï¸ æ™¯ç‚¹å±•ç¤ºå’Œè¯¦æƒ…
- ğŸ—ºï¸ æ—…æ¸¸è·¯çº¿è§„åˆ’
- ğŸ‘¤ ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- ğŸ“± å“åº”å¼è®¾è®¡
- ğŸŒ å¤šè¯­è¨€æ”¯æŒ
- ğŸ’¬ è¯„è®ºç³»ç»Ÿ
- ğŸ“Š é¡µé¢æµè§ˆç»Ÿè®¡

### ç®¡ç†åå°åŠŸèƒ½
- ğŸ”§ ç³»ç»Ÿç®¡ç†é¢æ¿
- ğŸ“Š æ•°æ®åº“ä¿¡æ¯ç›‘æ§
- ğŸ“ˆ æ•°æ®åˆ†æå’Œç»Ÿè®¡
- ğŸ‘¥ ç”¨æˆ·ç®¡ç†
- ğŸ“ å†…å®¹ç®¡ç†
- ğŸ¥ è§†é¢‘ç®¡ç†
- ğŸ“° åšå®¢ç®¡ç†
- ğŸ“‹ æ´»åŠ¨æ—¥å¿—

## ğŸš€ å®å¡”é¢æ¿éƒ¨ç½² (ä¸»æ¨è)

### âœ… å®å¡”éƒ¨ç½²æˆåŠŸæ¡ˆä¾‹

**éƒ¨ç½²çŠ¶æ€**: å·²æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œ  
**éƒ¨ç½²æ—¶é—´**: 2025-11-01  
**éƒ¨ç½²æ–¹å¼**: æœ¬åœ°æ‰“åŒ…ä¸Šä¼   

**æˆåŠŸéªŒè¯é¡¹ç›®**:
- âœ… å‰ç«¯ç½‘ç«™æ­£å¸¸è®¿é—®å’Œæ˜¾ç¤º
- âœ… åç«¯ç®¡ç†ç³»ç»Ÿæ­£å¸¸æ‰“å¼€
- âœ… æ•°æ®åº“è¿æ¥å’Œè¯»å–æ­£å¸¸
- âœ… æ‰€æœ‰APIæ¥å£æ­£å¸¸å“åº”
- âœ… æ•°æ®åº“ä¿¡æ¯èœå•æ˜¾ç¤ºæ­£å¸¸ (å·²ä¿®å¤404é”™è¯¯)
- âœ… æ•°æ®åº“è¿ç§»å®Œæˆï¼ŒåŒ…å«æˆéƒ½ç‰¹è‰²æ—…æ¸¸æ•°æ®

**å…³é”®ä¿®å¤å†…å®¹**:
1. **APIæ¥å£ä¿®å¤**: ä¿®å¤äº†åç«¯ç®¡ç†ç³»ç»Ÿæ•°æ®åº“ä¿¡æ¯èœå•çš„API 404é”™è¯¯
2. **æ•°æ®åº“è¿ç§»**: æˆåŠŸå°†æœ¬åœ°æ•°æ®åº“è¿ç§»åˆ°å®å¡”MySQLæ•°æ®åº“
3. **ç¯å¢ƒé…ç½®**: æ­£ç¡®é…ç½®äº†ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“è¿æ¥å’ŒAPIè·¯å¾„

### ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

#### 1. æœ¬åœ°å‡†å¤‡éƒ¨ç½²åŒ…

```bash
# Windows PowerShell / Mac Terminal / Linux Terminal
npm run package:baota
```

#### 2. å®å¡”é¢æ¿ç¯å¢ƒå‡†å¤‡

åœ¨å®å¡”é¢æ¿ä¸­å®‰è£…ï¼š
- **Nginx** 1.20+ 
- **MySQL** 8.0+ 
- **Node.js** 18.x 
- **PM2ç®¡ç†å™¨** 4.x

#### 3. ä¸Šä¼ å’Œè§£å‹

```bash
# ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹
cd /www/wwwroot/your-domain.com   
unzip travelweb-baota-*.zip
```

#### 4. å®‰è£…ä¾èµ–å’Œé…ç½®

```bash
# åªéœ€å®‰è£…åç«¯APIæœåŠ¡ä¾èµ–
npm install --production

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶é…ç½®æ•°æ®åº“è¿æ¥

# é…ç½®ç®¡ç†åå°
cd admin-panel
cp .env.example .env
# ç¼–è¾‘ç®¡ç†åå° .env æ–‡ä»¶
```

#### 5. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨PM2å¯åŠ¨åç«¯APIæœåŠ¡
pm2 start server.cjs --name "travelweb-api"
pm2 save
pm2 startup
```

#### 6. é…ç½®Nginx

åœ¨å®å¡”é¢æ¿æ·»åŠ ç½‘ç«™ï¼Œé…ç½®Nginxä»£ç†é™æ€æ–‡ä»¶å’ŒAPIã€‚

**è¯¦ç»†é…ç½®è¯·å‚è€ƒä¸‹æ–¹å®Œæ•´éƒ¨ç½²æŒ‡å—ã€‚**

## ğŸ“¦ ç¯å¢ƒè¦æ±‚

- **Node.js** 18.x æˆ–æ›´é«˜ç‰ˆæœ¬ (æ¨è 18.17.0+)
- **MySQL** 8.0+ æˆ– **SQLite** 3.x (å¼€å‘ç¯å¢ƒå¯é€‰)
- **npm** 9+ æˆ– **pnpm** 8+
- **Git** (ç”¨äºå…‹éš†é¡¹ç›®)

## ğŸ’» æœ¬åœ°å¼€å‘ç¯å¢ƒéƒ¨ç½²

### 1. **å…‹éš†é¡¹ç›®**

```bash
# Windows PowerShell
git clone <repository-url>
cd travelweb

# Mac/Linux Terminal  
git clone <repository-url>
cd travelweb

# æˆ–è€…å¦‚æœå·²ä¸‹è½½å‹ç¼©åŒ…
# Windows: è§£å‹åˆ° d:\code\travelweb ç›®å½•
# Mac/Linux: è§£å‹åˆ° ~/code/travelweb ç›®å½•
```

### 2. **å®‰è£…ä¾èµ–**

```bash
# Windows PowerShell / Mac Terminal / Linux Terminal
# å®‰è£…ä¸»é¡¹ç›®ä¾èµ–
npm install

# å®‰è£…ç®¡ç†åå°ä¾èµ–
cd admin-panel
npm install
cd ..
```

### 3. **æ•°æ®åº“é…ç½®**

**é€‰é¡¹A: MySQLæ•°æ®åº“ (æ¨èç”Ÿäº§ç¯å¢ƒ)**

```bash
# Windows - å¯åŠ¨MySQLæœåŠ¡
net start mysql80

# Mac - å¯åŠ¨MySQLæœåŠ¡
brew services start mysql
# æˆ–è€…
sudo /usr/local/mysql/support-files/mysql.server start

# Linux - å¯åŠ¨MySQLæœåŠ¡
sudo systemctl start mysql
# æˆ–è€…
sudo service mysql start

# ç™»å½•MySQL (æ‰€æœ‰å¹³å°)
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE travelweb_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'travelweb_user'@'localhost' IDENTIFIED BY 'your_strong_password';
GRANT ALL PRIVILEGES ON travelweb_db.* TO 'travelweb_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

**é€‰é¡¹B: SQLiteæ•°æ®åº“ (å¿«é€Ÿå¼€å‘)**
```bash
# æ— éœ€é¢å¤–é…ç½®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºSQLiteæ–‡ä»¶
# é€‚åˆå¿«é€Ÿå¼€å‘å’Œæµ‹è¯•
```

### 4. **ç¯å¢ƒå˜é‡é…ç½®**

```bash
# Windows PowerShell
Copy-Item .env.example .env
Copy-Item admin-panel\.env.example admin-panel\.env

# Mac/Linux Terminal
cp .env.example .env
cp admin-panel/.env.example admin-panel/.env
```

**ç¼–è¾‘æ ¹ç›®å½• `.env` æ–‡ä»¶ï¼š**
```env
# æ•°æ®åº“é…ç½® (MySQL)
DB_TYPE=mysql
DB_HOST=localhost
DB_PORT=3306
DB_NAME=travelweb_db
DB_USER=travelweb_user
DB_PASSWORD=your_strong_password

# æˆ–è€…ä½¿ç”¨SQLite (å¼€å‘ç¯å¢ƒ)
# DB_TYPE=sqlite
# DB_PATH=./database/travelweb.db

# æœåŠ¡é…ç½®
PORT=3002
NODE_ENV=development
JWT_SECRET=your-jwt-secret-key-at-least-32-characters

# APIé…ç½®
API_BASE_URL=http://localhost:3002
CORS_ORIGINS=http://localhost:3000,http://localhost:5174
```

**ç¼–è¾‘ `admin-panel/.env` æ–‡ä»¶ï¼š**
```env
# ç®¡ç†åå°é…ç½®
VITE_NODE_ENV=development
VITE_API_BASE_URL=http://localhost:3002
VITE_ALLOWED_ORIGINS=http://localhost:5174
VITE_ENABLE_DEV_TOOLS=true
VITE_ENABLE_DEBUG=true
VITE_ENABLE_ERROR_REPORTING=false
```

### 5. **åˆå§‹åŒ–æ•°æ®åº“**

```bash
# Windows PowerShell / Mac Terminal / Linux Terminal
# MySQLæ•°æ®åº“åˆå§‹åŒ–
npm run init:mysql

# æˆ–è€…SQLiteæ•°æ®åº“åˆå§‹åŒ–
npm run init:sqlite
```

### 6. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

```bash
# æ–¹å¼1: åˆ†åˆ«å¯åŠ¨å„æœåŠ¡ (æ‰€æœ‰å¹³å°)
# å¯åŠ¨åç«¯APIæœåŠ¡ (ç«¯å£ 3002)
npm start

# æ–°å¼€ç»ˆç«¯å¯åŠ¨å‰ç«¯ (ç«¯å£ 3000)
npm run dev

# æ–°å¼€ç»ˆç«¯å¯åŠ¨ç®¡ç†åå° (ç«¯å£ 5174)
cd admin-panel
npm run dev
```

```bash
# æ–¹å¼2: ä½¿ç”¨å¹¶å‘å¯åŠ¨ (æ¨èï¼Œæ‰€æœ‰å¹³å°)
npm run dev:all
```

**è®¿é—®åœ°å€ï¼š**
- ğŸŒ **å‰ç«¯ç½‘ç«™**: http://localhost:3000
- ğŸ”§ **ç®¡ç†åå°**: http://localhost:5174
- ğŸ”Œ **APIæœåŠ¡**: http://localhost:3002
- ğŸ“Š **APIæ–‡æ¡£**: http://localhost:3002/api-docs (å¦‚æœå¯ç”¨)

### æœ¬åœ° Nginx é…ç½® (å¯é€‰)

å¦‚æœæ‚¨å¸Œæœ›åœ¨æœ¬åœ°ä½¿ç”¨ Nginx è¿›è¡Œåå‘ä»£ç†å’Œé™æ€æ–‡ä»¶æœåŠ¡ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é…ç½®ï¼š

#### 1. **æœ¬åœ° Nginx å®‰è£…**

**Windows:**
```bash
# ä¸‹è½½ Nginx for Windows
# è®¿é—® http://nginx.org/en/download.html
# ä¸‹è½½ nginx/Windows-x.x.x ç‰ˆæœ¬
# è§£å‹åˆ°æœ¬åœ°ç›®å½•ï¼Œä¾‹å¦‚ï¼šC:\nginx
```

**Mac:**
```bash
# ä½¿ç”¨ Homebrew å®‰è£…
brew install nginx

# æˆ–è€…ä¸‹è½½äºŒè¿›åˆ¶åŒ…
# è®¿é—® http://nginx.org/en/download.html
```

**Linux (Ubuntu/Debian):**
```bash
# ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…
sudo apt update
sudo apt install nginx
```

**Linux (CentOS/RHEL):**
```bash
# ä½¿ç”¨ yum æˆ– dnf å®‰è£…
sudo yum install nginx
# æˆ–è€…
sudo dnf install nginx
```

#### 2. **å¯åŠ¨ Nginx**

```bash
# Windows PowerShell (ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ)
cd C:\nginx  # æˆ–æ‚¨çš„ Nginx å®‰è£…è·¯å¾„
.\nginx.exe

# Mac
sudo nginx
# æˆ–è€…ä½¿ç”¨ Homebrew æœåŠ¡
brew services start nginx

# Linux
sudo systemctl start nginx
# æˆ–è€…
sudo service nginx start

# æ£€æŸ¥ Nginx æ˜¯å¦è¿è¡Œ (æ‰€æœ‰å¹³å°)
# Windows: .\nginx.exe -t
# Mac/Linux: nginx -t
```

#### 3. **æœ¬åœ° Nginx é…ç½®æ–‡ä»¶**

**é…ç½®æ–‡ä»¶ä½ç½®ï¼š**
- **Windows**: `C:\nginx\conf\nginx.conf` (æˆ–æ‚¨çš„å®‰è£…è·¯å¾„)
- **Mac**: `/usr/local/etc/nginx/nginx.conf` (Homebrew) æˆ– `/etc/nginx/nginx.conf`
- **Linux**: `/etc/nginx/nginx.conf`

ç¼–è¾‘ `nginx.conf` æ–‡ä»¶ï¼š

```nginx
# nginx.conf - æœ¬åœ°å¼€å‘ç¯å¢ƒé…ç½®
worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    # å¼€å‘ç¯å¢ƒæœåŠ¡å™¨é…ç½®
    server {
        listen       80;
        server_name  localhost;

        # å‰ç«¯åº”ç”¨ (å¼€å‘æœåŠ¡å™¨ä»£ç†)
        location / {
            proxy_pass http://localhost:3000;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # WebSocket æ”¯æŒ (Vite HMR)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }

        # ç®¡ç†åå° (å¼€å‘æœåŠ¡å™¨ä»£ç†)
        location /admin {
            proxy_pass http://localhost:5174;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # WebSocket æ”¯æŒ (Vite HMR)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }

        # API æœåŠ¡ä»£ç†
        location /api/ {
            proxy_pass http://localhost:3002/api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # è¶…æ—¶è®¾ç½®
            proxy_connect_timeout 30s;
            proxy_send_timeout 30s;
            proxy_read_timeout 30s;
        }
    }

    # ç”Ÿäº§ç¯å¢ƒé¢„è§ˆé…ç½® (æ„å»ºåçš„é™æ€æ–‡ä»¶)
    server {
        listen       8080;
        server_name  localhost;
        root         D:/code/travelweb/dist;  # ä¿®æ”¹ä¸ºæ‚¨çš„é¡¹ç›®è·¯å¾„
        index        index.html;

        # å‰ç«¯åº”ç”¨ (é™æ€æ–‡ä»¶)
        location / {
            try_files $uri $uri/ /index.html;
        }

        # ç®¡ç†åå° (é™æ€æ–‡ä»¶)
        location /admin {
            alias D:/code/travelweb/admin-panel/dist;  # ä¿®æ”¹ä¸ºæ‚¨çš„é¡¹ç›®è·¯å¾„
            try_files $uri $uri/ /index.html;
        }

        # API æœåŠ¡ä»£ç†
        location /api/ {
            proxy_pass http://localhost:3002/api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
```

#### 4. **Nginx ç®¡ç†å‘½ä»¤**

```bash
# Windows PowerShell (åœ¨ Nginx å®‰è£…ç›®å½•ä¸‹)
# å¯åŠ¨ Nginx
.\nginx.exe

# é‡æ–°åŠ è½½é…ç½®
.\nginx.exe -s reload

# åœæ­¢ Nginx
.\nginx.exe -s stop

# æµ‹è¯•é…ç½®æ–‡ä»¶
.\nginx.exe -t

# æŸ¥çœ‹ Nginx è¿›ç¨‹
tasklist /fi "imagename eq nginx.exe"

# å¼ºåˆ¶ç»“æŸ Nginx è¿›ç¨‹ (å¦‚æœéœ€è¦)
taskkill /f /im nginx.exe
```

```bash
# Mac Terminal
# å¯åŠ¨ Nginx
sudo nginx
# æˆ–è€…ä½¿ç”¨ Homebrew æœåŠ¡
brew services start nginx

# é‡æ–°åŠ è½½é…ç½®
sudo nginx -s reload

# åœæ­¢ Nginx
sudo nginx -s stop
# æˆ–è€…ä½¿ç”¨ Homebrew æœåŠ¡
brew services stop nginx

# æµ‹è¯•é…ç½®æ–‡ä»¶
nginx -t

# æŸ¥çœ‹ Nginx è¿›ç¨‹
ps aux | grep nginx
```

```bash
# Linux Terminal
# å¯åŠ¨ Nginx
sudo systemctl start nginx
# æˆ–è€…
sudo service nginx start

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx
# æˆ–è€…
sudo service nginx reload

# åœæ­¢ Nginx
sudo systemctl stop nginx
# æˆ–è€…
sudo service nginx stop

# æµ‹è¯•é…ç½®æ–‡ä»¶
nginx -t

# æŸ¥çœ‹ Nginx çŠ¶æ€
sudo systemctl status nginx
# æˆ–è€…
sudo service nginx status
```

#### 5. **æœ¬åœ°è®¿é—®åœ°å€**

é…ç½®å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

**å¼€å‘ç¯å¢ƒ (ç«¯å£ 80)ï¼š**
- ğŸŒ **å‰ç«¯ç½‘ç«™**: http://localhost (ä»£ç†åˆ° :3000)
- ğŸ”§ **ç®¡ç†åå°**: http://localhost/admin (ä»£ç†åˆ° :5174)
- ğŸ”Œ **APIæœåŠ¡**: http://localhost/api (ä»£ç†åˆ° :3002)

**ç”Ÿäº§é¢„è§ˆ (ç«¯å£ 8080)ï¼š**
- ğŸŒ **å‰ç«¯ç½‘ç«™**: http://localhost:8080 (é™æ€æ–‡ä»¶)
- ğŸ”§ **ç®¡ç†åå°**: http://localhost:8080/admin (é™æ€æ–‡ä»¶)
- ğŸ”Œ **APIæœåŠ¡**: http://localhost:8080/api (ä»£ç†åˆ° :3002)

#### 6. **æ•…éšœæ’é™¤**

**å¸¸è§é—®é¢˜ï¼š**

1. **ç«¯å£è¢«å ç”¨**
```bash
# Windows - æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :80
netstat -ano | findstr :8080
# ç»“æŸå ç”¨è¿›ç¨‹
taskkill /f /pid <PID>

# Mac/Linux - æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :80
lsof -i :8080
# ç»“æŸå ç”¨è¿›ç¨‹
sudo kill -9 <PID>
```

2. **é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯**
```bash
# Windows: ç¡®ä¿è·¯å¾„ä½¿ç”¨æ­£æ–œæ æˆ–åŒåæ–œæ 
# æ­£ç¡®: D:/code/travelweb/dist æˆ– D:\\code\\travelweb\\dist

# Mac/Linux: ä½¿ç”¨ç»å¯¹è·¯å¾„
# æ­£ç¡®: /Users/username/code/travelweb/dist
# æˆ–: /home/username/code/travelweb/dist
```

3. **æƒé™é—®é¢˜**
```bash
# Windows: ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell
# å³é”®ç‚¹å‡» PowerShell -> "ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"

# Mac/Linux: ä½¿ç”¨ sudo æƒé™
sudo nginx
sudo systemctl start nginx
```

4. **é˜²ç«å¢™é˜»æ­¢**
```bash
# Windows: åœ¨ Windows é˜²ç«å¢™ä¸­å…è®¸ nginx.exe
# æ§åˆ¶é¢æ¿ -> ç³»ç»Ÿå’Œå®‰å…¨ -> Windows Defender é˜²ç«å¢™ -> å…è®¸åº”ç”¨é€šè¿‡é˜²ç«å¢™

# Mac: å…è®¸åº”ç”¨é€šè¿‡é˜²ç«å¢™
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add /usr/local/bin/nginx

# Linux: é…ç½® ufw é˜²ç«å¢™
sudo ufw allow 80
sudo ufw allow 443
```

## ğŸš€ å®å¡”é¢æ¿éƒ¨ç½² (æ¨è)

### âœ… å®å¡”éƒ¨ç½²æˆåŠŸæ¡ˆä¾‹

**éƒ¨ç½²çŠ¶æ€**: å·²æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œ  
**éƒ¨ç½²æ—¶é—´**: 2025-11-01  
**éƒ¨ç½²æ–¹å¼**: æœ¬åœ°æ‰“åŒ…ä¸Šä¼   

**æˆåŠŸéªŒè¯é¡¹ç›®**:
- âœ… å‰ç«¯ç½‘ç«™æ­£å¸¸è®¿é—®å’Œæ˜¾ç¤º
- âœ… åç«¯ç®¡ç†ç³»ç»Ÿæ­£å¸¸æ‰“å¼€
- âœ… æ•°æ®åº“è¿æ¥å’Œè¯»å–æ­£å¸¸
- âœ… æ‰€æœ‰APIæ¥å£æ­£å¸¸å“åº”
- âœ… æ•°æ®åº“ä¿¡æ¯èœå•æ˜¾ç¤ºæ­£å¸¸ (å·²ä¿®å¤404é”™è¯¯)
- âœ… æ•°æ®åº“è¿ç§»å®Œæˆï¼ŒåŒ…å«æˆéƒ½ç‰¹è‰²æ—…æ¸¸æ•°æ®

**å…³é”®ä¿®å¤å†…å®¹**:
1. **APIæ¥å£ä¿®å¤**: ä¿®å¤äº†åç«¯ç®¡ç†ç³»ç»Ÿæ•°æ®åº“ä¿¡æ¯èœå•çš„API 404é”™è¯¯
   - åœ¨ `api/server.js` ä¸­æ·»åŠ äº† `/api/database/info` è·¯ç”±
   - ä¿®å¤äº†æ•°æ®åº“APIæ¨¡å—å¯¼å…¥è·¯å¾„é—®é¢˜
2. **æ•°æ®åº“è¿ç§»**: æˆåŠŸå°†æœ¬åœ°æ•°æ®åº“è¿ç§»åˆ°å®å¡”MySQLæ•°æ®åº“
3. **ç¯å¢ƒé…ç½®**: æ­£ç¡®é…ç½®äº†ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“è¿æ¥å’ŒAPIè·¯å¾„

### æ–¹æ¡ˆä¸€ï¼šæœ¬åœ°æ‰“åŒ…ä¸Šä¼  (æ¨è)

è¿™æ˜¯æœ€ç®€å•ã€æœ€å¯é çš„éƒ¨ç½²æ–¹å¼ã€‚

**ğŸš€ ç®€åŒ–éƒ¨ç½²æµç¨‹æ€»è§ˆï¼š**
1. **æœ¬åœ°ç¼–è¯‘æ‰“åŒ…** â†’ ç”ŸæˆåŒ…å«é™æ€æ–‡ä»¶çš„éƒ¨ç½²åŒ…
2. **ä¸Šä¼ è§£å‹** â†’ å°†éƒ¨ç½²åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è§£å‹
3. **å®‰è£…åç«¯ä¾èµ–** â†’ åªéœ€å®‰è£…åç«¯APIæœåŠ¡çš„ç”Ÿäº§ä¾èµ–
4. **é…ç½®ç¯å¢ƒ** â†’ é…ç½®æ•°æ®åº“å’ŒAPIè¿æ¥
5. **å¯åŠ¨æœåŠ¡** â†’ ä½¿ç”¨PM2å¯åŠ¨åç«¯APIæœåŠ¡
6. **é…ç½®Nginx** â†’ é…ç½®é™æ€æ–‡ä»¶æœåŠ¡å’ŒAPIä»£ç†

**ç›¸æ¯”ä¼ ç»Ÿéƒ¨ç½²çš„ä¼˜åŠ¿ï¼š**
- âš¡ **æ›´å¿«**ï¼šæ— éœ€åœ¨æœåŠ¡å™¨ä¸Šç¼–è¯‘å‰ç«¯ä»£ç 
- ğŸ›¡ï¸ **æ›´ç¨³å®š**ï¼šé¿å…æœåŠ¡å™¨ç¯å¢ƒå·®å¼‚å¯¼è‡´çš„ç¼–è¯‘é—®é¢˜
- ğŸ’¾ **æ›´çœèµ„æº**ï¼šæœåŠ¡å™¨æ— éœ€å®‰è£…å‰ç«¯å¼€å‘ä¾èµ–
- ğŸ¯ **æ›´ç®€å•**ï¼šéƒ¨ç½²æ­¥éª¤æ›´å°‘ï¼Œå‡ºé”™æ¦‚ç‡æ›´ä½

#### 1. æœ¬åœ°å‡†å¤‡éƒ¨ç½²åŒ…

```bash
# æ„å»ºå¹¶æ‰“åŒ…é¡¹ç›®
npm run package:baota
```

æ‰§è¡Œå®Œæˆåï¼Œä¼šåœ¨ `deploy-package` ç›®å½•ç”Ÿæˆå‹ç¼©åŒ…ï¼š
- `travelweb-baota-YYYY-MM-DDTHH-mm-ss.zip`

**æœ€æ–°éƒ¨ç½²åŒ…ä¿¡æ¯ï¼š**
- **æ—¶é—´æˆ³æ ¼å¼**ï¼š`YYYY-MM-DDTHH-mm-ss` (ISO 8601æ ¼å¼ï¼Œä¾¿äºç‰ˆæœ¬ç®¡ç†)
- **åŒ…å«å†…å®¹**ï¼šå®Œæ•´çš„å‰åç«¯ä»£ç ã€é…ç½®æ–‡ä»¶ã€æ•°æ®åº“è„šæœ¬
- **é¢„æœŸå¤§å°**ï¼šçº¦ 15-25 MB (åŒ…å«æ‰€æœ‰ç¼–è¯‘åçš„é™æ€èµ„æº)
- **æœ€æ–°ç‰ˆæœ¬**ï¼š`travelweb-baota-2025-10-26T16-02-08.zip` (å·²ä¿®å¤init-mysql.jsç¼ºå¤±é—®é¢˜)

**éƒ¨ç½²åŒ…å†…å®¹è¯´æ˜ï¼š**
- `dist/` - å‰ç«¯ç½‘ç«™ç¼–è¯‘åçš„é™æ€æ–‡ä»¶ï¼ˆHTMLã€CSSã€JSï¼‰
- `admin-panel/` - ç®¡ç†åå°å®Œæ•´ç›®å½•
  - `admin-panel/dist/` - ç®¡ç†åå°ç¼–è¯‘åçš„é™æ€æ–‡ä»¶
  - `admin-panel/.env.example` - ç®¡ç†åå°ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿
  - `admin-panel/package.json` - ç®¡ç†åå°ä¾èµ–é…ç½®
  - `admin-panel/README.md` - ç®¡ç†åå°éƒ¨ç½²è¯´æ˜
- `src/`ã€`api/`ã€`database/` - åç«¯APIæœåŠ¡æºç 
- `server.cjs` - åç«¯æœåŠ¡å¯åŠ¨æ–‡ä»¶
- `package.json` - åç«¯æœåŠ¡ä¾èµ–é…ç½®
- `nginx/` - Nginxé…ç½®æ¨¡æ¿
- `.env.example` - ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿

**é‡è¦æ–‡ä»¶è¯´æ˜ï¼š**
- `admin-panel/.env.example`: ç®¡ç†åå°ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿ï¼ŒåŒ…å«APIåœ°å€ã€åŸºç¡€è·¯å¾„ç­‰å…³é”®é…ç½®
- `admin-panel/package.json`: ç®¡ç†åå°çš„ä¾èµ–ä¿¡æ¯ï¼Œç”¨äºäº†è§£æŠ€æœ¯æ ˆå’Œç‰ˆæœ¬
- `admin-panel/README.md`: ç®¡ç†åå°çš„è¯¦ç»†éƒ¨ç½²å’Œé…ç½®è¯´æ˜
- `admin-panel/dist/`: å·²ç¼–è¯‘çš„ç®¡ç†åå°é™æ€èµ„æºï¼Œå¯ç›´æ¥éƒ¨ç½²

**æœ¬åœ°ç¼–è¯‘æ‰“åŒ…çš„ä¼˜åŠ¿ï¼š**
- âœ… å‰ç«¯å’Œç®¡ç†åå°å·²ç¼–è¯‘ä¸ºé™æ€æ–‡ä»¶ï¼Œæ— éœ€åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…Node.jså¼€å‘ä¾èµ–
- âœ… å‡å°‘æœåŠ¡å™¨èµ„æºæ¶ˆè€—å’Œéƒ¨ç½²æ—¶é—´
- âœ… é¿å…æœåŠ¡å™¨ç¯å¢ƒå·®å¼‚å¯¼è‡´çš„ç¼–è¯‘é—®é¢˜
- âœ… æé«˜éƒ¨ç½²æˆåŠŸç‡å’Œç¨³å®šæ€§

#### 2. å®å¡”é¢æ¿ç¯å¢ƒå‡†å¤‡

åœ¨å®å¡”é¢æ¿ä¸­å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
- **Nginx** 1.20+ ï¼ˆç”¨äºé™æ€æ–‡ä»¶æœåŠ¡å’ŒAPIä»£ç†ï¼‰
- **MySQL** 5.7+ æˆ– 8.0+ ï¼ˆæ•°æ®åº“æœåŠ¡ï¼‰
- **Node.js** 18.x ï¼ˆä»…ç”¨äºè¿è¡Œåç«¯APIæœåŠ¡ï¼‰
- **PM2ç®¡ç†å™¨** 4.x ï¼ˆç”¨äºç®¡ç†åç«¯APIè¿›ç¨‹ï¼‰

**æ³¨æ„ï¼š** Node.jsä»…ç”¨äºè¿è¡Œåç«¯APIæœåŠ¡ï¼Œå‰ç«¯å’Œç®¡ç†åå°å·²ç¼–è¯‘ä¸ºé™æ€æ–‡ä»¶ï¼Œç”±Nginxç›´æ¥æä¾›æœåŠ¡ã€‚

#### 3. ä¸Šä¼ å’Œè§£å‹

1. å°†å‹ç¼©åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ `/www/wwwroot/chengex.wisdomier.com` ç›®å½•
2. è§£å‹æ–‡ä»¶ï¼š
```bash
cd /www/wwwroot/chengex.wisdomier.com   
unzip travelweb-baota-*.zip

```

#### 4. å®‰è£…åç«¯APIæœåŠ¡ä¾èµ–

**é‡è¦è¯´æ˜ï¼š** ç”±äºå·²ç»åœ¨æœ¬åœ°ç¼–è¯‘æ‰“åŒ…ï¼Œå‰ç«¯å’Œç®¡ç†åå°å·²ç»æ˜¯é™æ€æ–‡ä»¶ï¼Œ**æ— éœ€å®‰è£…å‰ç«¯ä¾èµ–**ã€‚

**åªéœ€è¦ä¸ºåç«¯APIæœåŠ¡å®‰è£…ç”Ÿäº§è¿è¡Œæ—¶ä¾èµ–ï¼š**

```bash
# åªå®‰è£…åç«¯APIæœåŠ¡çš„ç”Ÿäº§ä¾èµ–
npm install --production
```

**ä¸éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼š**
```bash
# âŒ ä¸éœ€è¦æ‰§è¡Œ - ç®¡ç†åå°å·²ç¼–è¯‘ä¸ºé™æ€æ–‡ä»¶
# cd admin-panel && npm install --production && cd ..
```

**ä¾èµ–å®‰è£…è¯´æ˜ï¼š**
- âœ… **åç«¯APIæœåŠ¡**ï¼šéœ€è¦å®‰è£…ç”Ÿäº§ä¾èµ–ï¼ˆExpressã€MySQLé©±åŠ¨ç­‰ï¼‰
- âŒ **å‰ç«¯ç½‘ç«™**ï¼šå·²ç¼–è¯‘ä¸ºé™æ€æ–‡ä»¶ï¼ˆdist/ç›®å½•ï¼‰ï¼Œæ— éœ€å®‰è£…ä¾èµ–
- âŒ **ç®¡ç†åå°**ï¼šå·²ç¼–è¯‘ä¸ºé™æ€æ–‡ä»¶ï¼ˆadmin-panel/dist/ç›®å½•ï¼‰ï¼Œæ— éœ€å®‰è£…ä¾èµ–

**æœ¬åœ°ç¼–è¯‘æ‰“åŒ…çš„ä¼˜åŠ¿ï¼š**
- âœ… **ä»…éœ€å®‰è£…åç«¯ä¾èµ–**ï¼šç”±äºå‰ç«¯ç½‘ç«™å’Œç®¡ç†åå°å·²ç»ç¼–è¯‘ä¸ºé™æ€æ–‡ä»¶ï¼Œåªéœ€è¦å®‰è£…åç«¯APIæœåŠ¡çš„ç”Ÿäº§ä¾èµ–
- âœ… **æ— éœ€å‰ç«¯ä¾èµ–**ï¼šä¸éœ€è¦å®‰è£…Reactã€Viteã€TypeScriptç­‰å‰ç«¯å¼€å‘ä¾èµ–
- âœ… **æ— éœ€ç®¡ç†åå°ä¾èµ–**ï¼šç®¡ç†åå°çš„`admin-panel/dist/`å·²ç»æ˜¯ç¼–è¯‘åçš„é™æ€èµ„æº
- âš¡ **å¿«é€Ÿéƒ¨ç½²**ï¼šå¤§å¤§å‡å°‘äº†ä¾èµ–å®‰è£…æ—¶é—´å’ŒæœåŠ¡å™¨å­˜å‚¨ç©ºé—´

#### 5. é…ç½®ç¯å¢ƒå˜é‡

**éœ€è¦é…ç½®ä¸¤ä¸ª .env æ–‡ä»¶ï¼š**

**5.1 é…ç½®åç«¯æœåŠ¡å™¨ç¯å¢ƒå˜é‡**

ç¼–è¾‘æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶ï¼š
```bash
cp .env.example .env
nano .env
```

é‡è¦é…ç½®é¡¹ï¼š
```env
# æ•°æ®åº“é…ç½®
DB_TYPE=mysql
DB_HOST=localhost
DB_PORT=3306
DB_NAME=travelweb_db
DB_USER=your_username
DB_PASSWORD=your_password

# æœåŠ¡é…ç½®
PORT=3002
NODE_ENV=production

# JWTå¯†é’¥ (å¿…é¡»ä¿®æ”¹ä¸ºè‡³å°‘32ä½å­—ç¬¦)
JWT_SECRET=your-super-secret-jwt-key-at-least-32-characters-long

# CORSé…ç½® (æ›¿æ¢ä¸ºå®é™…åŸŸå)
CORS_ORIGINS=https://chengex.wisdomier.com,https://www.chengex.wisdomier.com

# APIé…ç½®
API_BASE_URL=https://chengex.wisdomier.com
```

**5.2 é…ç½®ç®¡ç†åå°ç¯å¢ƒå˜é‡**

ç¼–è¾‘ `admin-panel/.env` æ–‡ä»¶ï¼š
```bash
cp admin-panel/.env.example admin-panel/.env
nano admin-panel/.env
```

å…³é”®é…ç½®é¡¹ï¼š
```env
# ç¯å¢ƒé…ç½®
VITE_NODE_ENV=production

# API é…ç½® (å¿…é¡»ä¿®æ”¹ä¸ºå®é™…åŸŸå)
VITE_API_BASE_URL=https://chengex.wisdomier.com/api

# åº”ç”¨é…ç½®
VITE_APP_TITLE=TravelWeb ç®¡ç†åå°
VITE_APP_VERSION=1.0.0

# å¼€å‘æœåŠ¡å™¨é…ç½®
VITE_DEV_SERVER_PORT=5174

# å®‰å…¨é…ç½® (æ›¿æ¢ä¸ºå®é™…åŸŸå)
VITE_ALLOWED_ORIGINS=https://chengex.wisdomier.com

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_DEV_TOOLS=false
VITE_ENABLE_DEBUG=false
VITE_SHOW_DETAILED_ERRORS=false
VITE_ENABLE_ERROR_REPORTING=true
VITE_ENABLE_PERFORMANCE_MONITOR=true

# æ–‡ä»¶ä¸Šä¼ é…ç½®
VITE_MAX_FILE_SIZE=10
VITE_ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,image/webp,video/mp4,video/webm
```

#### 6. æ•°æ®åº“åˆå§‹åŒ–å’Œè¿ç§»

**6.1 åœ¨å®å¡”é¢æ¿åˆ›å»ºæ•°æ®åº“**

1. ç™»å½•å®å¡”é¢æ¿ â†’ æ•°æ®åº“ â†’ æ·»åŠ æ•°æ®åº“
2. æ•°æ®åº“åï¼š`travelweb_db`
3. ç”¨æˆ·åï¼š`travelweb_user` 
4. å¯†ç ï¼šè®¾ç½®å¼ºå¯†ç 
5. å­—ç¬¦é›†ï¼š`utf8mb4`

**6.2 æ•°æ®åº“è¿ç§» (å·²éªŒè¯æˆåŠŸ)**

æœ¬é¡¹ç›®æä¾›äº†å®Œæ•´çš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼Œæ”¯æŒä»æœ¬åœ°æ•°æ®åº“è¿ç§»åˆ°å®å¡”æ•°æ®åº“ï¼š

```bash
# ä½¿ç”¨ç»Ÿä¸€è¿ç§»è„šæœ¬ (æ¨è)
node database/migrate-database.cjs \
  --source-host localhost \
  --source-user root \
  --source-password your_local_password \
  --source-database travelweb_db \
  --target-host localhost \
  --target-user travelweb_user \
  --target-password your_baota_password \
  --target-database travelweb_db \
  --backup \
  --verify

# æˆ–è€…ä½¿ç”¨ä¼ ç»Ÿåˆå§‹åŒ–æ–¹å¼
npm run init:mysql
```

**è¿ç§»å·¥å…·ç‰¹æ€§**:
- âœ… **å®Œæ•´è¿ç§»**: è¿ç§»æ‰€æœ‰è¡¨ç»“æ„å’Œæ•°æ®
- âœ… **æ•°æ®éªŒè¯**: è‡ªåŠ¨éªŒè¯è¿ç§»åçš„æ•°æ®å®Œæ•´æ€§
- âœ… **å¤‡ä»½æ”¯æŒ**: è¿ç§»å‰è‡ªåŠ¨å¤‡ä»½ç›®æ ‡æ•°æ®åº“
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶
- âœ… **å¹²è¿è¡Œæ¨¡å¼**: æ”¯æŒ `--dry-run` é¢„è§ˆè¿ç§»æ“ä½œ
- âœ… **SSHæ”¯æŒ**: æ”¯æŒé€šè¿‡SSHè¿æ¥è¿œç¨‹æ•°æ®åº“

**è¿ç§»æˆåŠŸéªŒè¯**:
- âœ… æ‰€æœ‰è¡¨ç»“æ„æ­£ç¡®åˆ›å»º
- âœ… æˆéƒ½ç‰¹è‰²æ—…æ¸¸æ•°æ®å®Œæ•´è¿ç§»
- âœ… æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡
- âœ… APIæ¥å£æ•°æ®æŸ¥è¯¢æ­£å¸¸
- âœ… ç®¡ç†åå°æ•°æ®åº“ä¿¡æ¯æ˜¾ç¤ºæ­£å¸¸

#### 7. å¯åŠ¨æœåŠ¡

**ä½¿ç”¨PM2å¯åŠ¨åç«¯æœåŠ¡ï¼š**
```bash
# å¯åŠ¨åç«¯APIæœåŠ¡
pm2 start server.cjs --name "travelweb-api" --env production

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs travelweb-api

# ä¿å­˜PM2é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup

# é‡å¯æœåŠ¡ (å¦‚æœéœ€è¦)
pm2 restart travelweb-api

# åœæ­¢æœåŠ¡ (å¦‚æœéœ€è¦)
pm2 stop travelweb-api
```

**PM2 é…ç½®æ–‡ä»¶ (å¯é€‰)ï¼š**

åˆ›å»º `ecosystem.config.js` æ–‡ä»¶ï¼š
```javascript
module.exports = {
  apps: [{
    name: 'travelweb-api',
    script: 'server.cjs',
    cwd: '/www/wwwroot/chengex.wisdomier.com',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3002
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true
  }]
};
```

ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨ï¼š
```bash
pm2 start ecosystem.config.js
```

#### 8. Nginxé…ç½®

åœ¨å®å¡”é¢æ¿æ·»åŠ ç½‘ç«™ï¼Œé…ç½®Nginxï¼š

```nginx
server {
    listen 80;
    listen 443 ssl http2;
    server_name chengex.wisdomier.com;
    root /www/wwwroot/chengex.wisdomier.com/dist;
    index index.html;

    # HTTPé‡å®šå‘åˆ°HTTPS
    if ($scheme != "https") {
        return 301 https://$host$request_uri;
    }

    # å‰ç«¯åº”ç”¨
    location / {
        try_files $uri $uri/ /index.html;
    }

    # ç®¡ç†åå° - ä¿®å¤åçš„é…ç½®
    location /admin {
        alias /www/wwwroot/chengex.wisdomier.com/admin-panel/dist;
        try_files $uri $uri/ /index.html;
        
        # ç¡®ä¿ç®¡ç†åå°çš„é™æ€èµ„æºèƒ½æ­£ç¡®åŠ è½½
        location ~* ^/admin/(.+\.(js|css|png|jpg|jpeg|gif|ico|svg))$ {
            alias /www/wwwroot/chengex.wisdomier.com/admin-panel/dist/$1;
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # SSLé…ç½®
    ssl_certificate /www/server/panel/vhost/cert/chengex.wisdomier.com/fullchain.pem;
    ssl_certificate_key /www/server/panel/vhost/cert/chengex.wisdomier.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;

    # APIä»£ç† (ç«¯å£3002)
    location /api/ {
        proxy_pass http://localhost:3002/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
        
        # ç¼“å­˜æ§åˆ¶
        proxy_cache_bypass $http_upgrade;
        proxy_no_cache $http_upgrade;
        
        # CORSæ”¯æŒ
        add_header Access-Control-Allow-Origin * always;
        add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
        add_header Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization" always;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # é”™è¯¯é¡µé¢
    error_page 404 /index.html;
    error_page 500 502 503 504 /index.html;
}
```

#### 9. è®¿é—®æµ‹è¯•

- å‰ç«¯: https://chengex.wisdomier.com
- ç®¡ç†åå°: https://chengex.wisdomier.com/admin
- API: https://chengex.wisdomier.com/api

### æ–¹æ¡ˆäºŒï¼šæœåŠ¡å™¨ç›´æ¥æ„å»º

å¦‚æœæœåŠ¡å™¨æ€§èƒ½è¾ƒå¥½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ„å»ºï¼š

1. å…‹éš†ä»£ç åˆ°æœåŠ¡å™¨
2. å®‰è£…ä¾èµ–ï¼š`npm install && cd admin-panel && npm install && cd ..`
3. æ„å»ºé¡¹ç›®ï¼š`npm run build:production`
4. æŒ‰ç…§æ–¹æ¡ˆä¸€çš„æ­¥éª¤5-9è¿›è¡Œé…ç½®

## ğŸš€ ç”Ÿäº§ç¯å¢ƒé…ç½®æ¸…å•

### ğŸ“‹ ä»æœ¬åœ°å¼€å‘åˆ°ç”Ÿäº§éƒ¨ç½²å¿…é¡»ä¿®æ”¹çš„é…ç½®

#### 1. åŸŸåé…ç½® (å¿…é¡»ä¿®æ”¹)

**éœ€è¦æ›¿æ¢ localhost çš„åœ°æ–¹ï¼š**

| é…ç½®æ–‡ä»¶ | æœ¬åœ°å¼€å‘ | ç”Ÿäº§ç¯å¢ƒ | è¯´æ˜ |
|---------|---------|---------|------|
| å‰ç«¯APIé…ç½® | `http://localhost:3002` | `https://chengex.wisdomier.com/api` | å‰ç«¯è°ƒç”¨åç«¯APIçš„åœ°å€ |
| ç®¡ç†åå°APIé…ç½® | `http://localhost:3002` | `https://chengex.wisdomier.com/api` | ç®¡ç†åå°è°ƒç”¨APIçš„åœ°å€ |
| ç®¡ç†åå°è®¿é—®åœ°å€ | `http://localhost:5174` | `https://chengex.wisdomier.com/admin` | ç®¡ç†åå°è®¿é—®åœ°å€ |
| Nginxé…ç½® | `server_name localhost` | `server_name chengex.wisdomier.com` | æœåŠ¡å™¨åŸŸå |
| CORSé…ç½® | `localhost:3000,localhost:5174` | `chengex.wisdomier.com` | è·¨åŸŸç™½åå• |

**å…·ä½“ä¿®æ”¹ç¤ºä¾‹ï¼š**

1. **å‰ç«¯é…ç½®æ–‡ä»¶** (`src/config/api.js` æˆ–ç±»ä¼¼æ–‡ä»¶)ï¼š
```javascript
// æœ¬åœ°å¼€å‘
const API_BASE_URL = 'http://localhost:3002/api';

// ç”Ÿäº§ç¯å¢ƒ - ä¿®æ”¹ä¸ºï¼š
const API_BASE_URL = 'https://chengex.wisdomier.com/api';
```

2. **ç®¡ç†åå°ç¯å¢ƒå˜é‡é…ç½®** (`admin-panel/.env` æ–‡ä»¶)ï¼š
```env
# æœ¬åœ°å¼€å‘
VITE_NODE_ENV=development
VITE_API_BASE_URL=http://localhost:3002
VITE_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5174
VITE_ENABLE_DEV_TOOLS=true
VITE_ENABLE_DEBUG=true

# ç”Ÿäº§ç¯å¢ƒ - ä¿®æ”¹ä¸ºï¼š
VITE_NODE_ENV=production
VITE_API_BASE_URL=https://chengex.wisdomier.com/api
VITE_ALLOWED_ORIGINS=https://chengex.wisdomier.com
VITE_BASE_PATH=/admin
VITE_ENABLE_DEV_TOOLS=false
VITE_ENABLE_DEBUG=false
```

3. **åç«¯CORSé…ç½®** (`.env` æ–‡ä»¶)ï¼š
```env
# æœ¬åœ°å¼€å‘
CORS_ORIGIN=http://localhost:3000,http://localhost:5174

# ç”Ÿäº§ç¯å¢ƒ - ä¿®æ”¹ä¸ºï¼š
CORS_ORIGIN=https://chengex.wisdomier.com
```

#### 2. ç¯å¢ƒå˜é‡å¯¹æ¯”è¡¨

**åç«¯æœåŠ¡å™¨é…ç½® (æ ¹ç›®å½• `.env`)ï¼š**

| é…ç½®é¡¹ | æœ¬åœ°å¼€å‘ | ç”Ÿäº§ç¯å¢ƒ | æ˜¯å¦å¿…é¡»ä¿®æ”¹ |
|-------|---------|---------|-------------|
| `NODE_ENV` | `development` | `production` | âœ… å¿…é¡» |
| `DB_HOST` | `localhost` | `localhost` æˆ– `æ•°æ®åº“æœåŠ¡å™¨IP` | ğŸ”„ è§†æƒ…å†µ |
| `DB_NAME` | `travelweb_db` | `travelweb_db` | âœ… ä¿æŒä¸€è‡´ |
| `DB_USER` | `travelweb_user` | `ç”Ÿäº§ç¯å¢ƒç”¨æˆ·å` | âœ… å¿…é¡» |
| `DB_PASSWORD` | `å¼€å‘å¯†ç ` | `å¼ºå¯†ç ` | âœ… å¿…é¡» |
| `JWT_SECRET` | `å¼€å‘å¯†é’¥` | `å¤æ‚éšæœºå¯†é’¥` | âœ… å¿…é¡» |
| `PORT` | `3002` | `3002` | âœ… ä¿æŒä¸€è‡´ |
| `CORS_ORIGIN` | `localhoståœ°å€` | `å®é™…åŸŸå` | âœ… å¿…é¡» |

**ç®¡ç†åå°é…ç½® (`admin-panel/.env`)ï¼š**

| é…ç½®é¡¹ | æœ¬åœ°å¼€å‘ | ç”Ÿäº§ç¯å¢ƒ | æ˜¯å¦å¿…é¡»ä¿®æ”¹ |
|-------|---------|---------|-------------|
| `VITE_NODE_ENV` | `development` | `production` | âœ… å¿…é¡» |
| `VITE_API_BASE_URL` | `http://localhost:3002` | `https://chengex.wisdomier.com` | âœ… å¿…é¡» |
| `VITE_ALLOWED_ORIGINS` | `localhoståœ°å€` | `å®é™…åŸŸå` | âœ… å¿…é¡» |
| `VITE_ENABLE_DEV_TOOLS` | `true` | `false` | âœ… å¿…é¡» |
| `VITE_ENABLE_DEBUG` | `true` | `false` | âœ… å¿…é¡» |
| `VITE_SHOW_DETAILED_ERRORS` | `true` | `false` | âœ… å¿…é¡» |
| `VITE_ENABLE_ERROR_REPORTING` | `false` | `true` | âœ… å¿…é¡» |
| `VITE_ENABLE_PERFORMANCE_MONITOR` | `false` | `true` | âœ… å¿…é¡» |

#### 3. æ•°æ®åº“é…ç½®

**ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“è®¾ç½®ï¼š**
```sql
-- åˆ›å»ºç”Ÿäº§æ•°æ®åº“
CREATE DATABASE travelweb_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆä½¿ç”¨å¼ºå¯†ç ï¼‰
CREATE USER 'travelweb_prod'@'localhost' IDENTIFIED BY 'your-strong-password-here';
GRANT ALL PRIVILEGES ON travelweb_db.* TO 'travelweb_prod'@'localhost';
FLUSH PRIVILEGES;
```

**ç”Ÿäº§ç¯å¢ƒ .env é…ç½®ï¼š**
```env
# æ•°æ®åº“é…ç½®
DB_TYPE=mysql
DB_HOST=localhost
DB_PORT=3306
DB_NAME=travelweb_db
DB_USER=travelweb_prod
DB_PASSWORD=your-strong-password-here

# æœåŠ¡é…ç½®
PORT=3002
NODE_ENV=production

# å®‰å…¨é…ç½® (å¿…é¡»ä¿®æ”¹)
JWT_SECRET=your-super-complex-jwt-secret-key-at-least-32-characters-long

# CORSé…ç½® (æ›¿æ¢ä¸ºå®é™…åŸŸå)
CORS_ORIGIN=https://chengex.wisdomier.com
```

**JWTå®‰å…¨é…ç½®è¯´æ˜ï¼š**
- **ä»¤ç‰Œæœ‰æ•ˆæœŸ**ï¼šè®¿é—®ä»¤ç‰Œ24å°æ—¶æœ‰æ•ˆï¼Œè‡ªåŠ¨åˆ·æ–°æœºåˆ¶ç¡®ä¿ç”¨æˆ·ä½“éªŒ
- **å¯†é’¥è¦æ±‚**ï¼šJWT_SECRETå¿…é¡»è‡³å°‘32ä¸ªå­—ç¬¦ï¼Œå»ºè®®ä½¿ç”¨64ä½éšæœºå­—ç¬¦ä¸²
- **å®‰å…¨å»ºè®®**ï¼š
  - ä½¿ç”¨å¼ºéšæœºå¯†é’¥ç”Ÿæˆå™¨ï¼š`openssl rand -hex 32`
  - å®šæœŸè½®æ¢JWTå¯†é’¥ï¼ˆå»ºè®®æ¯6ä¸ªæœˆï¼‰
  - ç”Ÿäº§ç¯å¢ƒç»ä¸ä½¿ç”¨ç¤ºä¾‹å¯†é’¥
  - å¯†é’¥åº”åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
```

#### 4. SSL/HTTPS é…ç½®

**ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¯ç”¨HTTPSï¼š**

1. **ç”³è¯·SSLè¯ä¹¦** (æ¨èLet's Encryptå…è´¹è¯ä¹¦)
2. **Nginx HTTPSé…ç½®ï¼š**
```nginx
server {
    listen 443 ssl http2;
    server_name chengex.wisdomier.com;
    
    ssl_certificate /etc/letsencrypt/live/chengex.wisdomier.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/chengex.wisdomier.com/privkey.pem;
    
    # SSLå®‰å…¨é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # å…¶ä»–é…ç½®...
}

# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name chengex.wisdomier.com;
    return 301 https://$server_name$request_uri;
}
```

#### 5. éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

**é…ç½®æ£€æŸ¥ï¼š**
- [ ] å·²å°†æ‰€æœ‰ `localhost` æ›¿æ¢ä¸ºå®é™…åŸŸå
- [ ] å·²ä¿®æ”¹æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç 
- [ ] å·²è®¾ç½®å¤æ‚çš„JWTå¯†é’¥ (è‡³å°‘32ä½å­—ç¬¦)
- [ ] å·²é…ç½®ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“
- [ ] å·²æ›´æ–°CORSç™½åå•
- [ ] å·²è®¾ç½® `NODE_ENV=production`
- [ ] å·²é…ç½® `admin-panel/.env` æ–‡ä»¶
- [ ] å·²è®¾ç½® `VITE_NODE_ENV=production`
- [ ] å·²æ›´æ–° `VITE_API_BASE_URL` ä¸ºå®é™…åŸŸå
- [ ] å·²é…ç½® `VITE_ALLOWED_ORIGINS` ä¸ºå®é™…åŸŸå

**å®‰å…¨æ£€æŸ¥ï¼š**
- [ ] æ•°æ®åº“å¯†ç è¶³å¤Ÿå¤æ‚
- [ ] JWTå¯†é’¥å·²æ›´æ¢ä¸ºç”Ÿäº§å¯†é’¥
- [ ] å·²é…ç½®SSLè¯ä¹¦
- [ ] å·²è®¾ç½®é˜²ç«å¢™è§„åˆ™
- [ ] å·²ç§»é™¤å¼€å‘è°ƒè¯•ä¿¡æ¯
- [ ] å·²å…³é—­ç®¡ç†åå°å¼€å‘å·¥å…· (`VITE_ENABLE_DEV_TOOLS=false`)
- [ ] å·²å…³é—­ç®¡ç†åå°è°ƒè¯•æ¨¡å¼ (`VITE_ENABLE_DEBUG=false`)
- [ ] å·²å¯ç”¨é”™è¯¯ä¸ŠæŠ¥ (`VITE_ENABLE_ERROR_REPORTING=true`)

**åŠŸèƒ½æ£€æŸ¥ï¼š**
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸è®¿é—®
- [ ] ç®¡ç†åå°æ­£å¸¸è®¿é—®
- [ ] APIæ¥å£æ­£å¸¸å“åº”
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸

**æ€§èƒ½æ£€æŸ¥ï¼š**
- [ ] å·²å¯ç”¨Gzipå‹ç¼©
- [ ] å·²é…ç½®é™æ€èµ„æºç¼“å­˜
- [ ] å·²ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- [ ] å·²è®¾ç½®PM2è¿›ç¨‹ç®¡ç†

## ğŸ”§ å¯ç”¨è„šæœ¬

```bash
# å¼€å‘
npm run dev                 # å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm start                   # å¯åŠ¨åç«¯æœåŠ¡å™¨

# æ„å»º
npm run build:frontend      # æ„å»ºå‰ç«¯
npm run build:admin         # æ„å»ºç®¡ç†åå°
npm run build:all          # æ„å»ºå‰ç«¯å’Œåå°
npm run build:production    # ç”Ÿäº§ç¯å¢ƒæ„å»º

# éƒ¨ç½²
npm run package:baota       # æ‰“åŒ…å®å¡”éƒ¨ç½²åŒ…
npm run upload:baota        # ä¸Šä¼ åˆ°å®å¡”æœåŠ¡å™¨

# æ•°æ®åº“
npm run init:mysql          # åˆå§‹åŒ–MySQLæ•°æ®åº“ (ä¸»è¦)
npm run init:sqlite         # åˆå§‹åŒ–SQLiteæ•°æ®åº“ (å¯é€‰)
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è§£å†³

**1. æ•°æ®åº“è¿æ¥å¤±è´¥**

```bash
# Windows - æ£€æŸ¥MySQLæœåŠ¡
Get-Service -Name "MySQL80"
net start mysql80

# Mac - å¯åŠ¨MySQL
brew services start mysql

# Linux - å¯åŠ¨MySQL
sudo systemctl start mysql

# æµ‹è¯•è¿æ¥ (æ‰€æœ‰å¹³å°)
mysql -u travelweb_user -p -h localhost travelweb_db
```

**2. ç«¯å£è¢«å ç”¨**

```bash
# Windows - æŸ¥çœ‹å’Œç»“æŸè¿›ç¨‹
netstat -ano | findstr :3002
taskkill /f /pid <PID>

# Mac/Linux - æŸ¥çœ‹å’Œç»“æŸè¿›ç¨‹
lsof -i :3002
sudo kill -9 <PID>
```

**å¸¸è§ç«¯å£ï¼š**
- **3000**: å‰ç«¯å¼€å‘æœåŠ¡å™¨
- **3002**: åç«¯APIæœåŠ¡
- **5174**: ç®¡ç†åå°å¼€å‘æœåŠ¡å™¨

**3. æ„å»ºå¤±è´¥**

```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£… (æ‰€æœ‰å¹³å°)
npm cache clean --force
rm -rf node_modules package-lock.json  # Mac/Linux
Remove-Item -Recurse -Force node_modules  # Windows
npm install

# æ£€æŸ¥Node.jsç‰ˆæœ¬ (éœ€è¦18.x+)
node --version
```

**4. PM2è¿›ç¨‹é—®é¢˜**

```bash
# æŸ¥çœ‹å’Œç®¡ç†PM2è¿›ç¨‹ (æ‰€æœ‰å¹³å°)
pm2 status
pm2 restart travelweb-api
pm2 logs travelweb-api
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# å¼€å‘ç¯å¢ƒæ—¥å¿—
npm start  # æŸ¥çœ‹åç«¯æ—¥å¿—
npm run dev  # æŸ¥çœ‹å‰ç«¯æ—¥å¿—

# ç”Ÿäº§ç¯å¢ƒæ—¥å¿—
pm2 logs travelweb-api  # PM2æ—¥å¿—
tail -f /var/log/nginx/error.log  # Nginxæ—¥å¿— (Linux)
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

**å¼€å‘ç¯å¢ƒä¼˜åŒ–ï¼š**
- å…³é—­ä¸å¿…è¦çš„åå°ç¨‹åº
- ä½¿ç”¨SSDç¡¬ç›˜
- å¢åŠ Node.jså†…å­˜é™åˆ¶ï¼š`export NODE_OPTIONS="--max-old-space-size=4096"`
- ä½¿ç”¨ç°ä»£ç»ˆç«¯ (Windows Terminal / iTerm2 / Gnome Terminal)

## ğŸ“ é¡¹ç›®ç»“æ„

```
travelweb/
â”œâ”€â”€ src/                    # å‰ç«¯æºç 
â”œâ”€â”€ admin-panel/            # ç®¡ç†åå°
â”œâ”€â”€ api/                    # åç«¯API
â”œâ”€â”€ database/               # æ•°æ®åº“è„šæœ¬
â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”œâ”€â”€ dist/                   # å‰ç«¯æ„å»ºè¾“å‡º
â”œâ”€â”€ scripts/                # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ server.cjs              # åç«¯æœåŠ¡å™¨
â”œâ”€â”€ package.json            # é¡¹ç›®é…ç½®
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜
```

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ¸…å•

**å¿…é¡»é…ç½®é¡¹ï¼š**
- [ ] ä¿®æ”¹JWTå¯†é’¥ä¸ºå¤æ‚éšæœºå­—ç¬¦ä¸² (è‡³å°‘32ä½)
- [ ] è®¾ç½®å¼ºå¯†ç çš„æ•°æ®åº“ç”¨æˆ·
- [ ] é…ç½®HTTPSå’ŒSSLè¯ä¹¦
- [ ] è®¾ç½®æ­£ç¡®çš„CORSç™½åå•
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™ (åªå¼€æ”¾80, 443ç«¯å£)

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Node.jsç‰ˆæœ¬æ˜¯å¦ä¸º18.x+
2. æ•°æ®åº“è¿æ¥é…ç½®æ˜¯å¦æ­£ç¡®
3. ç«¯å£æ˜¯å¦è¢«å ç”¨
4. é˜²ç«å¢™è®¾ç½®æ˜¯å¦æ­£ç¡®

---

**ç‰ˆæœ¬**: v1.6.1  
**æ›´æ–°æ—¶é—´**: 2025å¹´11æœˆ  
**éƒ¨ç½²çŠ¶æ€**: âœ… å®å¡”é¢æ¿ç”Ÿäº§ç¯å¢ƒè¿è¡Œä¸­
